















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-03-07 09:18:57 -0400">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - Introduction to Glatos"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Introduction to Glatos
  </title>  

  </head>
  <body>

    


<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body pre-alpha">
    This lesson is still being designed and assembled (Pre-Alpha version)
  </div>
</div>





    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://software-carpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/swc-icon-blue.svg" alt="Software Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../00-introduction-to-glatos/index.html">Introduction to GLATOS Data Processing</a></li>
            
            
            <li><a href="../01-basic-visualizations/index.html">Basic Visualization and Plotting</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            
            <li><a href="../about/index.html">About</a></li>
            
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit//aio.md" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>
















<h1 class="maintitle"><a href="../index.html">Introduction to Glatos</a></h1>



<article>

<h1 id="introduction-to-glatos-data-processing" class="maintitle">Introduction to GLATOS Data Processing</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 0 min
      <br />
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How do I load my data into GLATOS?</p>
</li>
	
	<li><p>How do I filter out false detections?</p>
</li>
	
	<li><p>How can I consolidate my detections into detection events?</p>
</li>
	
	<li><p>How do I summarize my data?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>GLATOS is a powerful toolkit that provides a wide range of functionality for loading,
processing, and visualizing your data. With it, you can gain valuable insights
with quick and easy commands that condense high volumes of base R into straightforward
functions, with enough versatility to meet a variety of needs.</p>

<p>First, we must set our working directory and import the relevant library.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Set your working directory ####</span><span class="w">

</span><span class="n">setwd</span><span class="p">(</span><span class="s2">"./code/glatos/"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">glatos</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Your code may not be in the ‘code/glatos’ folder, so use the appropriate file path for
your data.</p>

<p>Next, we will create paths to our detections and receiver files. GLATOS can
function with both GLATOS and OTN-formatted data, but the functions are different
for each. Both, however, provide a marked performance boost over base R, and Both
ensure that the resulting data set will be compatible with the rest of the glatos
framework.</p>

<p>We will use the NSBS Blue Shark detections that come bundled with GLATOS. Please
read the system.file documentation to understand how to load your own data from
its location. You may not need to use the system.file command to build the path
if the data is stored in the same place you’re running your script from.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get file path to example blue shark OTN data</span><span class="w">
</span><span class="n">det_file_name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">system.file</span><span class="p">(</span><span class="s2">"extdata"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue_shark_detections.csv"</span><span class="p">,</span><span class="w">
                        </span><span class="n">package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"glatos"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Receiver Location</span><span class="w">
</span><span class="n">rec_file_name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">system.file</span><span class="p">(</span><span class="s2">"extdata"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hfx_deployments.csv"</span><span class="p">,</span><span class="w">
                               </span><span class="n">package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"glatos"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Remember: you can always check a function’s documentation by typing a question
mark, followed by the name of the function.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## GLATOS help files are helpful!! ####</span><span class="w">
</span><span class="o">?</span><span class="n">read_otn_detections</span><span class="w">
</span></code></pre></div></div>

<p>With our file path in hand, we’ll want to use the read_otn_detections function
to load our data into a dataframe. In this case, our data is formatted in the OTN
style- if it were GLATOS formatted, we would want to use read_glatos_detections()
instead.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Save our detections file data into a dataframe called detections</span><span class="w">
</span><span class="n">detections</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_otn_detections</span><span class="p">(</span><span class="n">det_file</span><span class="o">=</span><span class="n">det_file_name</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Remember that we can use head() to inspect a few lines of our data to ensure it
was loaded properly.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># View first 2 rows of output</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">detections</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We can do the same for our receivers with the read_otn_deployments function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">read_otn_deployments</span><span class="w">
</span><span class="c1"># Save receiver information into receivers dataframe</span><span class="w">

</span><span class="n">receivers</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_otn_deployments</span><span class="p">(</span><span class="n">rec_file_name</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">receivers</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>With our data loaded, we next want to apply a false filtering algorithm to reduce
the number of false detections in our dataset. GLATOS uses the Pincock algorithm
to filter probable false detections based on the time lag between detections- tightly
clustered detections are weighted as more likely to be true, while detections spaced
out temporally will be marked as false.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Filtering False Detections ####</span><span class="w">
</span><span class="c1">## ?glatos::false_detections</span><span class="w">

</span><span class="c1"># write the filtered data (no rows deleted, just a filter column added)</span><span class="w">
</span><span class="c1"># to a new det_filtered object</span><span class="w">
</span><span class="n">detections_filtered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">false_detections</span><span class="p">(</span><span class="n">detections</span><span class="p">,</span><span class="w"> </span><span class="n">tf</span><span class="o">=</span><span class="m">3600</span><span class="p">,</span><span class="w"> </span><span class="n">show_plot</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">detections_filtered</span><span class="p">)</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">detections_filtered</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The false_detections function will add a new column to your dataframe, ‘passed_filter’.
This contains a boolean value that will tell you whether or not that record passed the
false detection filter. That information may be useful on its own merits; for now,
we will just use it to filter out the false detections.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Filter based on the column if you're happy with it.</span><span class="w">

</span><span class="n">detections_filtered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">detections_filtered</span><span class="p">[</span><span class="n">detections_filtered</span><span class="o">$</span><span class="n">passed_filter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,]</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">detections_filtered</span><span class="p">)</span><span class="w"> </span><span class="c1"># Smaller than before</span><span class="w">
</span></code></pre></div></div>

<p>With our data properly filtered, we can begin investigating it and developing some
insights. GLATOS provides a range of tools for summarizing our data so that we can
better see what our receivers are telling us.</p>

<p>We can begin with a summary by animal, which will group our data by the unique animals we’ve
detected.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Summarize Detections ####</span><span class="w">

</span><span class="c1"># By animal ====</span><span class="w">
</span><span class="n">sum_animal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarize_detections</span><span class="p">(</span><span class="n">detections_filtered</span><span class="p">,</span><span class="w"> </span><span class="n">summ_type</span><span class="o">=</span><span class="s1">'animal'</span><span class="p">)</span><span class="w">

</span><span class="n">sum_animal</span><span class="w">
</span></code></pre></div></div>

<p>We can also summarize by loation, grouping our data by distinct locations.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># By location ====</span><span class="w">

</span><span class="n">sum_location</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarize_detections</span><span class="p">(</span><span class="n">detections_filtered</span><span class="p">,</span><span class="w"> </span><span class="n">location_col</span><span class="o">=</span><span class="s1">'glatos_array'</span><span class="p">,</span><span class="w"> </span><span class="n">summ_type</span><span class="o">=</span><span class="s1">'location'</span><span class="p">)</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">sum_location</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Finally, we can summarize by both dimensions.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># By both dimensions</span><span class="w">
</span><span class="n">sum_animal_location</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarize_detections</span><span class="p">(</span><span class="n">det</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">detections_filtered</span><span class="p">,</span><span class="w">
                                            </span><span class="n">location_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'glatos_array'</span><span class="p">,</span><span class="w">
                                            </span><span class="n">summ_type</span><span class="o">=</span><span class="s1">'both'</span><span class="p">)</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">sum_animal_location</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>One other method- we can summarize by a subset of our animals as well. If we only want
to see summary data for a fixed set of animals, we can pass an array containing the animal_ids
that we want to see summarized.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># create a custom vector of Animal IDs to pass to the summary function</span><span class="w">
</span><span class="c1"># look only for these ids when doing your summary</span><span class="w">
</span><span class="n">tagged_fish</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"NSBS-Alison"</span><span class="p">,</span><span class="w"> </span><span class="s2">"NSBS-Brandy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"NSBS-Hey Jude"</span><span class="p">)</span><span class="w">

</span><span class="n">sum_animal_custom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summarize_detections</span><span class="p">(</span><span class="n">det</span><span class="o">=</span><span class="n">detections_filtered</span><span class="p">,</span><span class="w">
                                          </span><span class="n">animals</span><span class="o">=</span><span class="n">tagged_fish</span><span class="p">,</span><span class="w">
                                          </span><span class="n">summ_type</span><span class="o">=</span><span class="s1">'animal'</span><span class="p">)</span><span class="w">

</span><span class="n">sum_animal_custom</span><span class="w">
</span></code></pre></div></div>

<p>Alright, we can summarize our data. Let’s move on and see if we can make our dataset
more amenable to plotting by reducing it from detections to detection events.</p>

<p>Detection Events differ from detections in that they condense a lot of temporally and
spatially clustered detections for a single animal into a single detection event. This is
a powerful and useful way to clean up the data, and makes it easier to present and
clearer to read. Fortunately, GLATOS lets us to this easily.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Reduce Detections to Detection Events ####</span><span class="w">

</span><span class="c1"># ?glatos::detection_events</span><span class="w">
</span><span class="c1"># arrival and departure time instead of multiple detection rows</span><span class="w">
</span><span class="c1"># you specify how long an animal must be absent before starting a fresh event</span><span class="w">

</span><span class="n">events</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">detection_events</span><span class="p">(</span><span class="n">detections_filtered</span><span class="p">,</span><span class="w">
                           </span><span class="n">location_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'station'</span><span class="p">,</span><span class="w"> </span><span class="c1"># combines events across different receivers in a single array</span><span class="w">
                           </span><span class="n">time_sep</span><span class="o">=</span><span class="m">432000</span><span class="p">)</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">events</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We can also keep the full extent of our detections, but add a group column so that we can see how they
would have been condensed.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># keep detections, but add a 'group' column for each event group</span><span class="w">
</span><span class="n">detections_w_events</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">detection_events</span><span class="p">(</span><span class="n">detections_filtered</span><span class="p">,</span><span class="w">
                                        </span><span class="n">location_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'station'</span><span class="p">,</span><span class="w"> </span><span class="c1"># combines events across different receivers in a single array</span><span class="w">
                                        </span><span class="n">time_sep</span><span class="o">=</span><span class="m">432000</span><span class="p">,</span><span class="w"> </span><span class="n">condense</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>With our filtered data in hand, let’s move on to some visualization.</p>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
  </ul>
</blockquote>

<hr />

<h1 id="basic-visualization-and-plotting" class="maintitle">Basic Visualization and Plotting</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 0 min
      <br />
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>We can use GLATOS to quickly and effectively visualize our data, now that we’ve
cleaned it up.</p>

<p>One of the simplest ways is to use an abacus plot to display animal detections
against the appropriate stations.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Visualizing Data - Abacus Plots ####</span><span class="w">
</span><span class="c1"># ?glatos::abacus_plot</span><span class="w">
</span><span class="c1"># customizable version of the standard VUE-derived abacus plots</span><span class="w">

</span><span class="n">abacus_plot</span><span class="p">(</span><span class="n">detections_w_events</span><span class="p">,</span><span class="w">
            </span><span class="n">location_col</span><span class="o">=</span><span class="s1">'station'</span><span class="p">,</span><span class="w">
            </span><span class="n">main</span><span class="o">=</span><span class="s1">'NSBS Detections By Station'</span><span class="p">)</span><span class="w"> </span><span class="c1"># can use plot() variables here, they get passed thru to plot()</span><span class="w">
</span></code></pre></div></div>

<p>This is good, but cluttered. We can also filter out a single animal ID and plot
only the abacus plot for that.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pick a single fish to plot</span><span class="w">
</span><span class="n">abacus_plot</span><span class="p">(</span><span class="n">detections_filtered</span><span class="p">[</span><span class="n">detections_filtered</span><span class="o">$</span><span class="n">animal_id</span><span class="o">==</span><span class="w"> </span><span class="s2">"NSBS-Alison"</span><span class="p">,],</span><span class="w">
            </span><span class="n">location_col</span><span class="o">=</span><span class="s1">'station'</span><span class="p">,</span><span class="w">
            </span><span class="n">main</span><span class="o">=</span><span class="s2">"NSBS-Alison Detections By Station"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Additionally, if we only wanted to plot for a subset of receivers, we could do That
as well, using the following code to isolate a particular receiver.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># subset of receivers?</span><span class="w">

</span><span class="n">receivers</span><span class="w">

</span><span class="n">receivers_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">receivers</span><span class="p">[</span><span class="n">receivers</span><span class="o">$</span><span class="n">station</span><span class="o">==</span><span class="s1">'HFX005'</span><span class="p">,]</span><span class="w">
</span><span class="n">receivers_subset</span><span class="w">

</span><span class="n">det_first</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">detections</span><span class="o">$</span><span class="n">detection_timestamp_utc</span><span class="p">)</span><span class="w">
</span><span class="n">det_last</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">detections</span><span class="o">$</span><span class="n">detection_timestamp_utc</span><span class="p">)</span><span class="w">
</span><span class="n">receivers_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">receivers_subset</span><span class="p">[</span><span class="w">
  </span><span class="n">receivers_subset</span><span class="o">$</span><span class="n">deploy_date_time</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">det_last</span><span class="w"> </span><span class="o">&amp;</span><span class="w">
    </span><span class="n">receivers_subset</span><span class="o">$</span><span class="n">recover_date_time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">det_first</span><span class="w"> </span><span class="o">&amp;</span><span class="w">
    </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">receivers_subset</span><span class="o">$</span><span class="n">recover_date_time</span><span class="p">),]</span><span class="w"> </span><span class="c1">#removes deployments without recoveries</span><span class="w">

</span><span class="n">locs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">receivers_subset</span><span class="o">$</span><span class="n">station</span><span class="p">)</span><span class="w">

</span><span class="n">locs</span><span class="w">
</span></code></pre></div></div>

<p>(Have to revisit this after I talk with Ryan to see if it can be done. )</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Abacus Plots w/ Receiver History ####</span><span class="w">
</span><span class="c1"># Using the receiver data frame from the start:</span><span class="w">
</span><span class="c1"># See the receiver history behind the detections to know what you could see.</span><span class="w">

</span><span class="c1">#Mutate new glatos_array column into the receivers.</span><span class="w">
</span><span class="n">receivers_with_ga</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
  </span><span class="n">receivers</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">glatos_array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">receivers</span><span class="p">[</span><span class="n">station</span><span class="p">])</span><span class="w">

</span><span class="n">abacus_plot</span><span class="p">(</span><span class="n">detections_filtered</span><span class="p">[</span><span class="n">detections_filtered</span><span class="o">$</span><span class="n">animal_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'NSBS-Alison'</span><span class="p">,],</span><span class="w">
            </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w">
            </span><span class="n">type</span><span class="o">=</span><span class="s1">'b'</span><span class="p">,</span><span class="w">
            </span><span class="n">locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span><span class="w"> </span><span class="n">decreasing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
            </span><span class="n">receiver_history</span><span class="o">=</span><span class="n">receivers</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>If we want to see actual physical distribution, a bubble plot will serve us better.
(Add part for generating the NS map)
With the map generated, we can pass it to the bubble plot and see the results.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Bubble Plots for Spatial Distribution of Fish ####</span><span class="w">
</span><span class="c1"># bubble variable gets the summary data that was created to make the plot</span><span class="w">
</span><span class="n">detections_filtered</span><span class="w">
</span><span class="n">bubble</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">detection_bubble_plot</span><span class="p">(</span><span class="n">detections_filtered</span><span class="p">,</span><span class="w">
                                </span><span class="n">location_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'station'</span><span class="p">,</span><span class="w">
                                </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NS</span><span class="p">,</span><span class="w">
                                </span><span class="n">col_grad</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'white'</span><span class="p">,</span><span class="w"> </span><span class="s1">'green'</span><span class="p">),</span><span class="w">
                                </span><span class="n">background_xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-66</span><span class="p">,</span><span class="w"> </span><span class="m">-62</span><span class="p">),</span><span class="w">
                                </span><span class="n">background_ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">42</span><span class="p">,</span><span class="w"> </span><span class="m">46</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>There are additional customisations we can perform, which let us tune the output of the
bubble plot function to better suit our needs. A few of the parameters are demonstrated
below, but we encourage you to investigate the documentation and see what suits Your
needs.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># more complex example including zeroes by adding a specific</span><span class="w">
</span><span class="c1"># receiver locations dataset, in this case the receivers dataset above.</span><span class="w">

</span><span class="n">bubble_custom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">detection_bubble_plot</span><span class="p">(</span><span class="n">detections_filtered</span><span class="p">,</span><span class="w">
                                       </span><span class="n">location_col</span><span class="o">=</span><span class="s1">'station'</span><span class="p">,</span><span class="w">
                                       </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NS</span><span class="p">,</span><span class="w">
                                       </span><span class="n">background_xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-63.75</span><span class="p">,</span><span class="w"> </span><span class="m">-63.25</span><span class="p">),</span><span class="w">
                                       </span><span class="n">background_ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">44.25</span><span class="p">,</span><span class="w"> </span><span class="m">44.5</span><span class="p">),</span><span class="w">
                                       </span><span class="n">symbol_radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.7</span><span class="p">,</span><span class="w">
                                       </span><span class="n">receiver_locs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">receivers</span><span class="p">,</span><span class="w">
                                       </span><span class="n">col_grad</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'white'</span><span class="p">,</span><span class="w"> </span><span class="s1">'green'</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
  </ul>
</blockquote>

<hr />


</article>

      
      






<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
	
	Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2018–2020
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2016–2018
	by <a href="https://software-carpentry.org">Software Carpentry Foundation</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit//aio.md" data-checker-ignore>Edit on GitHub</a>
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:team@carpentries.org">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
